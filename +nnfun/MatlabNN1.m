function [Y,Xf,Af] = MatlabNN1(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 17-Jul-2015 13:41:57.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 7xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [0;-0.509943753887018;-0.496044142298002;-3.12871124167864;-0.477585455671001;-0.468765896273813;-3.13892773542393];
  x1_step1_gain = [2;1.89013525569251;1.84887238775667;0.319046720466909;2.08244056613219;1.98797296979235;0.318548005071929];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [2.7741642056803948;-2.1930861152137853;2.017879650904399;2.0915020497511883;-2.8080282894230217;2.2851454909223574;-2.773362933127077;-1.3779545315466653;1.7015110410075622;2.1779966368151928;1.3526084947326418;1.6916163833164337;-1.2389859439055957;0.92547432391820916;-1.9533162602368519;0.55513507731794898;-1.2223863862277442;0.94500414216621675;1.3411096645885956;1.0923107614324361;0.95244798834665945;0.2180140578006452;0.082279123239490562;0.12428966991913769;-0.12563503400909845;0.016419599614311581;-0.28054713651994645;-0.89745857394515605;-0.17316482545093312;0.039502342618119399;0.26840277764330006;-1.1676512153898455;0.45316453826756842;1.2279560382827066;-1.2195358399825083;-2.2752882683579743;0.7541468517450054;-0.96243413868313143;-1.1048401553171889;-0.90915601580061789;1.6803138022004258;2.3681987970073965;-1.800581040395038;2.1878629039522868;-2.2273312028245971;-1.7822115346618437;3.5448925686921111;-1.6079143480253124;-2.5048731163688642;-2.3837208046518086];
  IW1_1 = [-1.0906209644109757 1.294006132957888 -0.79646156788634115 -0.32067292352997734 -1.0996346157601107 0.99261553664930779 -0.32849819141153896;0.4313380040867838 -0.40386909365104573 0.62992788446097292 -1.1880636179130295 1.4464599117798624 -0.93903290741724565 0.55961492678987901;-0.25734222924856387 1.2243676180016465 -0.48448802039441491 -0.24218265503513858 1.6861549610387332 0.62750490304948081 0.24748431679574967;-1.2008401662597272 -1.0376120907575883 0.65793188909036382 1.5148262751504422 -0.054301970779716338 1.5631378943321708 -0.55835244948528739;0.80965570956079691 0.92238346979600538 -0.16436172172152416 -0.70127389848674049 0.061974989851405413 -0.9607088842513527 -3.5906558150132488;-0.45472265407776269 0.33671697311814086 -0.19101460160214839 1.1764449002046666 -1.0696256438429248 0.95218424196093832 -0.8037111131784016;0.17325694428596886 -0.59095410574220475 -1.0802891702810276 -2.125064705804339 -1.7074243352958116 1.1631507728807817 -2.0052186870447044;1.297928783550188 1.3466267639869072 1.3117986287325691 1.5713714203275242 0.78712940744460314 -0.87592198496754514 -0.39214678280471649;-1.6486921173585218 0.50465683424776364 -0.53839921129936874 -1.5195027843206126 -2.0208579092145191 -1.1964131431678096 -0.73997842094538824;-0.14848600562536113 1.5650728954907174 -0.78596119793260055 -0.15556775881051316 2.0392014482981216 1.1430387200632357 0.36063802730042305;-1.2328401228277506 0.94400478570539714 -0.053796786795335713 0.7052498407520762 -1.6702113812439559 1.1833124098892946 -0.28154991088039644;-0.7877154947494821 -1.4958362547010289 -0.32081264711121149 0.7042095082959885 0.15634629451753354 0.8541180373946331 2.4588781012208694;0.51955791647479244 -0.69488972029144935 0.27710793877772366 0.58879253452630587 -1.8285152253425638 -0.56651988525963959 -1.2425316766790944;-1.2740385405727586 -1.332319505022088 -0.049226256359149415 -0.80661259416376652 -0.25286448805380279 -1.3398743570640468 0.089858616557968243;1.450626328814649 -0.61007616315738844 0.47339192220882231 -1.6976851244783941 1.1035741654917584 0.58940377262316046 0.044236336330465267;-0.8834427888303954 -1.0832823478884206 -0.40609721884742545 -0.34030587884770297 1.0311590088305791 1.2570902316440333 1.2579125836235319;0.10886180948040107 1.0713968546599715 -0.32861943141854089 -0.64344864643207045 -0.72998330502106878 -0.60083375985387077 -2.5067422898533867;-0.98064921755038126 -0.38877144783311873 -1.3260718657593333 -0.66377716337336512 1.5729593384497518 0.89041596726323846 1.4953547426936855;-0.98568433550419721 -0.59183392710945693 -1.0356277790541719 -1.6317938916086701 -0.97864934657800962 0.034184369846382352 -0.46244733677566652;-1.9754744543698664 -0.77422606821308604 0.33595534565783436 0.28588325912298651 1.1670845965540326 1.1137907145481234 -0.81105199185928556;-0.36215364326168098 0.64253412668661558 -0.66800108419827287 2.4826286559133557 -0.53749735221999939 -0.54699963306670052 -0.022455827057454608;0.23886617985676264 0.98439115598533644 0.81875278656110539 -1.2837956376390038 -0.2787977230557161 -1.2908167592456403 -0.2717469934034295;-0.32762009454459456 -0.2529265348950745 -1.6619599617242093 0.60919132506412854 -1.1458465255587589 -0.57111959763847198 -1.4424052456448433;-0.5819975635703355 -0.7811194072369676 -0.25942761994131719 -0.76034826569301117 -0.68613192869273054 -1.253323439794013 -0.70713342792145073;-1.5151328057272231 -0.4206349127289854 0.27802936433584285 0.67523825657031133 1.377495470482754 -0.67174729796011445 -0.72692573372255498;1.292449650012208 0.39286814822674321 -0.87096162749345141 -0.39860746905799438 -0.96366696853507372 0.78032406925312603 0.32830192595037688;-0.40489088376143623 2.0043850572123962 -0.12492170929461191 -2.025862681364992 -0.7292181642908363 -1.3141494485355918 0.26097239756745416;-0.99181898189318407 0.045322226893016654 0.91822671279333823 -0.69582813927419207 -0.47390673023127505 -0.43835610742893832 0.77634149406153663;0.073558675881737146 0.35131125256455636 -1.5205099373294635 -1.0784379546448311 0.28247299265325521 0.13583384504679402 1.9263136752747712;0.11683018646883456 0.71541103855785693 -0.93838177434304693 0.60549925190458764 1.3098001894544902 0.59255283433352157 -0.30180028571788575;1.2724529268044416 -0.61829748835669107 -1.9108088386630302 -0.28308603051061487 -0.86449943328876133 -1.0349084379185209 -0.55727324233974185;-0.44314931742717123 1.3304175739416138 0.68229771810383744 0.38616527369463277 1.2396668868868606 0.4621640646200712 1.8111436271444528;1.2616726923426955 1.2939635256102364 -0.93752967364897255 -0.047805735424401113 -1.4592896871398031 -0.10870943147357169 -1.3493308712377037;0.078763084927024149 0.61083123614827539 -0.87261788020691289 1.1622509007567943 -1.258276185923447 1.4133615848789645 0.34662609663823257;-1.3993021962971854 0.85645695680637424 0.99141574366966734 -0.40343863897965476 -0.52599441597892205 -0.59746450739674439 1.1783700131041874;-1.298380074430153 -1.3510650163273998 0.84177982947993135 -1.1290043844874567 0.19645811233256719 -0.13979969550036808 -1.449087446603011;0.45319495712669061 0.35183994958360165 -0.75691760369805428 -0.070296668633108045 -1.6172512434443236 -1.175234347575852 -0.9885956073829586;-0.32764133244264027 -1.409731855349275 0.26153448252306705 1.7381316290177833 -0.050439062210701442 -0.25007570709046134 0.17104660712844594;-1.2714494364297491 -0.35833158654557706 -1.1598671327266032 -1.1040414696911192 -0.40240703919089171 -0.11879042685698246 0.89455324205682107;-0.11627466986439611 1.215885489102575 -0.053799930406885049 0.20578803782938823 0.96283133354438466 0.27999967357789923 1.3567186769831445;-0.30301718886155365 -1.1379236828399626 1.3391167542306548 1.6369720580678297 -0.16425032380907839 1.8534035746004121 -1.107045550150475;-0.41678936900439639 0.70385222157125982 1.1087376551353156 0.83529479703006781 -0.71427530394970662 0.44999144304782673 2.8645065603721558;-1.4750517442872171 -1.234968697994127 -0.38075976416010709 -0.65710794861094746 0.68343275501930223 -0.092270872010920171 0.11686794550586642;0.66954523150499545 0.32002617608681216 -0.2764668480705752 2.2154514327962218 1.1383963971997675 0.16289582446478201 1.4447317068561594;0.092662529276770628 -0.66719535700562249 1.2466914894463719 -1.0942279422932475 0.1635979249736777 -2.0722290597142772 -0.23090921339882986;0.041925503875173978 0.86224695793088013 0.11631544261919791 -0.93139322223504561 1.2918850242152655 -1.7401369183522946 -0.57157952381062316;1.6410027130564129 -2.0590204641825052 -1.9057614145225787 3.0897120449409168 0.96659169896288455 0.90656086108916167 0.40694025943606293;-0.70373830587030517 -0.64508761000778092 -1.1092336157103682 0.15227708808617244 1.6814765921143666 0.037859757123018499 0.94092128336843817;-1.0321267909578242 1.5808115990610476 -1.005395668736957 -0.059584695810970464 0.152482767268181 -0.84448769948197411 0.63993260127835172;-1.3597662359965186 0.82485117122639995 -1.124699617074395 -0.034111214923627856 0.25186955574024011 0.80457402947220025 0.81047859585168547];
  
  % Layer 2
  b2 = [0.16194449025210997;0.024004102660688857;0.90817174627114938];
  LW2_1 = [-0.64995464720842477 0.26528319909340392 0.39079639546604306 0.10901781556595082 -0.090584915119807929 0.19149204358823979 0.00015009637147292594 -0.00296049978236162 -0.0087777712135511179 -0.054644798259210953 0.21114060273963178 -0.27836372643290691 0.20368815610459853 -0.12703915121436701 0.13197125244542754 -0.10465316630043513 -0.1436362052708971 0.27071817023665734 -0.13781786103919383 -0.16063082929226255 -0.00078655556824597586 0.066700956659220711 0.063021687399374693 0.11404138988713876 0.025684132730667976 -0.29976725473565347 -0.090367131014385413 0.091409506786364447 0.074353884476426421 -0.17758659992519679 0.034169725563065849 -0.0090245854953681908 0.03990924305184531 -0.12937797649704122 -0.22943464328350935 -0.11765378192291231 -0.12015800372592338 -0.10499722995703999 0.013177722770489793 0.00070963921972507123 -0.099804994223727586 0.030581322420021439 -0.37000298214478428 -0.15094954504180405 -0.44089145517821576 0.097905653501173667 0.028304280414810281 -0.03154864089438518 0.0040115887571021691 0.24917947406097535;-0.70672878737133704 -0.63298377563740049 -0.10265558723874885 -0.19507343749747547 0.39983055754393015 -0.60516233964827892 0.084380381535417465 -0.15907101453733144 0.11133016983278425 0.15320461939946256 0.088482220858035712 0.16695962129699471 0.12904515213791332 -0.32343096533469368 -0.047472909676832084 -0.0099664341162414346 -0.16971524905502067 0.017875143118699907 -0.16296599687020269 0.12828546794437773 -0.17569099199952734 -0.14555082734496425 0.028535766816835249 0.12307098429703334 -0.42579411155785707 -0.65764744882940451 -0.0018644424416050936 0.24824549625128434 0.12197162368550117 0.031386074338016615 -0.030378838745534788 -0.039137067400567153 0.10198716120758632 -0.30952683727281322 -0.18050646657009925 0.070349917687734492 -0.07965606844362802 -0.12349691807963693 0.035152202098628751 0.047314176613490473 0.2176847184532805 0.17964081385064853 -0.40068243845490037 -0.0014038273662643572 -0.60704794882013768 0.03515258005966769 0.1773766775597112 0.095714702738775415 0.0044165421037052344 -0.33468287345744618;1.0562604767780179 0.28234893867697103 1.1124444154577204 1.6628262695702742 1.9737720666127687 0.51326931774714313 0.52678830327462456 -0.67716220955835893 0.90401235093186239 -0.92045232543255673 -0.85981759045368344 1.5098181110848095 0.31897574190244538 -0.18785478729812305 1.4806469710587837 -1.3490165208961198 0.76381056508819001 1.0755157392350985 -1.1876581649840312 -0.56329790791877854 0.90109971534807176 -0.87827500588099983 -0.38895541837293462 -0.41272673323208059 0.45711319187698662 1.0164336385250676 0.76363958769202245 -1.242724983099071 -0.54412207604244334 -0.22255211423269466 -0.35921289910830079 0.25338633498815338 -0.97347585044610108 0.6863262472980769 0.77517056004683182 1.0044304313420207 0.60421243714156525 -0.27770870900866246 0.60171769020041899 -0.57566372616680539 -0.552848745616209 1.4991467254275239 0.10323247943442507 1.0733897388226945 1.0234330491427222 0.45316450791305357 -1.3105746560056546 0.54557945424252152 -0.78361488712972449 -0.42499480120091521];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = [2.23962518379857;2.3776078318995;0.319101883680204];
  y1_step1_xoffset = [-0.439400886380383;-0.479895273387133;-3.12802989785636];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
