function [Y,Xf,Af] = MatlabNN2(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 22-Jul-2015 14:56:55.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 9xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 4xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [0;-0.509943753887018;-0.496044142298002;-0.999998672326938;-0.999999997613455;-0.455070422265124;-0.468765896273813;-0.99999793580007;-0.999999248949718];
  x1_step1_gain = [2;2.01913809193616;2.12229069067954;1.000001335066;1.00000000248081;2.22487040201394;2.13595220549544;1.0000021603108;1.0000003755529];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-2.7123092610098283;2.4139753175582079;-1.4890029404901672;-1.7323425088109519;-2.4900587008744881;-1.67452767321394;-1.4999504060970106;-1.747107342757934;1.3834597385111334;1.8355949245515166;-1.5834184446258279;1.0639959195546471;1.4207577631068009;-0.86541014783516157;1.0667457067130366;-0.83391695632639784;0.89756180617840253;0.61483801595587728;-0.73074276705149233;0.60217476930438374;0.30347783390466498;0.55222343118681771;0.062417429125236235;0.13198236346162154;0.04411112308216765;-0.15714613969277402;-0.30557840230090538;-0.033118019421500111;-0.13046633131032359;-0.33557940801576308;0.1886635012318261;-0.72222605375392934;-0.37291175918612046;-0.90471962517468696;-0.73645192910489454;-0.95645795067516004;-1.0633409293362017;0.79770289557609464;-1.4629537279669005;-1.075360267426219;1.8845144293504379;-1.5416743097855672;-1.4393504533783006;-1.908814680876082;-1.7250697533407751;1.8268874701996241;2.2490634882868785;2.1085703441938808;1.7087123256473455;-2.0296820298424976];
  IW1_1 = [0.44701530504956688 -1.1984023653396616 0.59819710041828078 0.29297819234153727 -0.46595055726761297 -0.63085485911043782 -0.78653156390268231 -0.14780141898041066 -0.99793330209756159;-0.0767518439308357 -0.62738891741538261 0.64690174213960827 -0.095987034600156479 -0.88968466624758558 -0.15722346564239537 -1.111253077129029 -0.10901664039076432 0.81378911625380812;0.16894741285763998 -0.87099688393571317 0.39413371330960972 -1.0114474835282574 0.16024171795530862 -0.9236305276429404 0.55020294125446556 -0.47546244399343418 0.096362687397359134;1.0454080412689837 -1.1323316048831202 0.95636071085725305 0.1725323985522364 0.91921140814632396 -1.1031149170941683 0.054707996867484038 0.65912998455572913 0.76531873314796406;0.30752149355142405 0.31713430140223536 0.24814708409489661 0.53380928228365943 -0.59660122254974968 -0.78096015399529373 1.6557565818986959 -0.32044522224889765 -0.4037941180803552;0.9656353659507585 0.43747484532591441 -0.56238113900402831 -0.05299161885518236 -0.46825422861894983 -0.41802734010542936 -0.62796684679412396 0.95957632163150741 1.4558826675332763;1.0352698860315854 0.85780871100209932 0.44398234105259898 -0.26159604202095182 0.55239731645322065 -0.067831987658935153 0.43141770906512861 -1.1135339856065372 -0.08955756531889783;0.38271303785775318 0.58832198622736931 -0.1122540474615587 -1.091533292807922 0.76919081043113002 0.56753263442536839 -0.57766528980022347 0.073365000382225695 -0.72503069470448966;-0.90686469684331827 -0.38257418823232769 -0.59694662094000905 1.025147598830626 -0.021721631119930335 0.68124812205228047 -0.45541113733318295 -0.76527799210802094 0.17925376677340471;0.041378800199384558 -0.96589522820674756 -0.9041999768619059 -0.051514644948243621 0.95261172782901538 -1.495732013196142 -0.025736552952408911 0.44242590690008571 -0.11005951663547253;0.18813876940469546 0.69277301223662047 0.78197119390261571 -1.87743704626236 -1.0199250773036221 0.39897327547638733 -0.036774100896955181 0.11025140814251912 0.39618224221591869;-0.94252660641039721 -0.61533455962193107 0.28635069273825803 0.067023277997798614 -0.16413937878082244 0.98658292717719331 0.77231765095837213 -1.2159412049940606 -0.33611601801879315;-0.59684739088076444 0.75796635563781112 -0.04834575135017407 0.22307175213138514 -0.80914282356977796 -0.95561117259907458 -0.65185432087915884 -0.011818598187030478 0.36658354714374058;0.15365703267394479 -0.4828338220419186 0.74761563100899309 0.5963388304821412 0.92996084439751336 0.18471173429412308 0.11687756924499673 0.64893258722423874 -0.32629387757731398;-0.78383530961523895 -0.22287049367016071 -0.1133601741601558 0.50818509451185157 0.12961665815379536 0.65488072463012781 -0.93491930980910709 -0.47534677924240215 -0.62551868201486505;1.0357633270282269 -0.13226218809467763 0.34543933242750807 0.28806568774628427 0.45867061689613581 -0.77819759371263897 -0.48666358930527659 0.79112101639269561 -0.0027064656209301041;-0.30302741896375573 -0.41497158443700383 0.69549542786722096 -0.29700219707847919 0.48750105532199384 -1.1169899141273318 -0.61628332460586055 -1.1397373620577138 -0.65651799670798638;-0.95043781842048303 -0.99113467279390788 -0.4079434122027345 0.33903447830527011 0.45406984593829014 0.54804031609444026 -0.7561933788510482 -0.44105211165386987 -0.6657109583602655;-0.12680321007480067 1.0992478998358248 0.14540371134828331 -0.99261296901815221 0.14723932255668554 0.204954054134248 -0.73572520005631803 -0.67639852082779595 -1.03810631440224;-0.86959832114619029 0.36678941513378377 0.17750951392191114 0.4054852697293459 1.0508945404927996 0.57166760995037313 -0.047085194830453946 0.85592328410646823 -0.29595216193333729;-0.089159133187949463 -0.18878651672053409 -0.59060666858673472 0.42287110012814955 0.60439809058055238 1.1031801184330057 0.44668228015580536 0.70859832637247633 0.25712711918158748;-0.34609000784021027 0.30290639441568534 0.49754422404599596 -0.0068912894993405499 0.68329262563919513 0.75762084739522617 -0.82921311450158175 -1.1012218349596921 -0.41614427387173536;0.55736857251096317 0.1884237849299788 0.19617555852589608 -0.00032137003129960318 -0.7532680536698142 0.19534583903845745 0.60873153369273303 0.62552651762494083 0.29509023363710896;0.3449851575851659 -0.72931184408588168 -0.5695884777539717 -1.0681666690333236 0.42592606090346719 -0.23922802551344818 0.65117286656106377 0.64165015760006949 0.55349229266244693;-0.99183235263504754 -0.28872803122977381 0.35514108278407591 0.024670304566803383 0.27009965269804298 0.18137343795774552 -0.21176975380128088 0.59971158818835668 -1.3066011809217655;0.094984575782127365 -0.37743555686689578 -0.46508724941132074 0.4390816867211747 -0.39569667042588474 0.25174400030481286 1.0202424320331338 1.1990375045095047 0.10658504143328169;-0.44085219805595949 0.30964381593225071 -0.16130970599782959 -1.1850847934512048 0.37965003779599638 -0.45623733513984177 0.9659616815184574 -0.089720784593586261 -0.69919779763206791;-0.73523153088333038 -0.81814754626801123 -0.94679040792663494 0.62311620634198783 -0.41013458719497337 -0.7765881497810746 0.50050792732840932 1.0886161947920574 -0.26160608341784503;-0.56778670631542294 -0.89877745066867332 0.43093618056012184 0.52592018130607143 -0.4673529086429602 -1.3532529319142124 0.47119806624797522 0.46066158805488611 0.48457162613089894;-0.85341627290574051 -0.55321188839561064 0.2728367423923862 -1.1296920987820631 0.53593398331016129 0.56897815954379349 0.2357971172844566 -0.66622476194229463 0.35950051848266584;1.2228987624641341 -0.84891571034177082 0.3315488428630497 -0.81214414159531778 0.016036305488881825 -0.85123398798167549 0.35645316873842869 -0.36464181541596358 0.55785601527397333;-0.8712202152498536 0.194069032779705 -0.98659285302211319 -1.2232013252758873 0.025051841483950676 -0.19317021503369455 0.45750329224772773 -0.11332326900693669 0.18795183082542027;-0.80832714871163625 -0.18238605142051781 -0.047625406579719726 1.2559532988254654 0.41642486824691777 0.091816728859036148 0.62907765008595129 0.78648903941913662 -0.9886292541073074;-1.2564401743186717 0.65761950030099792 0.79579502508107991 -0.58975213590837772 0.50271912183050682 -0.29325972277814727 -0.46523288083773173 0.48436685294895054 -0.97208445077743488;-0.64630165678946783 -0.74938585438470107 0.38389853250992811 0.64092634231192802 -0.0098818326340678886 -1.0377779892108654 -0.15884479569964588 1.1533763626360272 0.13549244118061918;-0.27429004068564228 -0.37942579340049903 0.53070268517807273 -1.3810529731121297 0.66769366551712905 0.43055746203081441 0.19600246295270096 0.36453713327561377 0.66922925284860901;0.090676101549238136 -0.58074344560721158 -0.27472794648988119 0.65600580660622632 -0.69909304843344555 1.0664333707552649 0.84600832307834506 -0.05109809294538939 0.29027526681214799;0.093392045771890017 0.5739753693873364 -0.34988891285544177 0.47161479665872175 -0.62848295968896117 -0.6693682707723837 -0.33576610387870859 0.3826946796191768 -0.7865734143779608;-0.58762245629637555 -0.68984059858997204 -0.041997946190968527 -0.2571440148262612 -0.75447536208893728 -0.058128035915389273 0.80374400921559142 0.068408995240862858 1.0520612929010187;-1.2165211640798543 -0.24238098811402842 -0.51730737245062619 0.65406609061192345 0.61535641181055878 1.2122193704434479 -0.13552113856627651 -0.70313700623853115 0.075969286503133573;1.3432947856489146 0.17362612397401556 0.60522754142333357 0.46982817908951802 0.63214549242971518 -0.35807917586821425 0.63236884910274294 0.57263823917573131 -0.75841239626691048;-0.58622702800044313 -0.036200834883212053 0.86916967217368946 -0.27390653532697851 -0.75588234819147249 -1.2024645628937722 0.60533643998212294 -0.70048624134138826 0.036370399211258113;-0.38185503813368599 0.16684999205756681 -0.61320528451144252 -0.38066279253642604 0.94345440578817796 1.020787819375045 -0.41114936803338986 -0.14374539430189454 -0.4641767963418969;-0.68283618517350875 0.66899174433283681 -1.0332679972615855 -1.4319690024762444 0.15006733153525575 0.35975383886521678 -0.59182583857670457 0.44092497026594885 -0.67917028542717262;-0.82567572467496808 0.1134502884699564 -1.0699261811884426 -0.90805909177044464 0.62940271342209098 -0.48014512962688027 0.21495952539683899 -0.47316598300156509 0.51085130669791301;1.3580512538233047 0.97956823011451699 0.5318014618818776 1.1337159599919888 -0.1503513471637328 0.1205102501700603 0.58038223195253391 0.51770643910206526 0.1861953420866633;0.8871526620154041 -1.027855313495678 -0.21382947301368005 0.50034188459732021 0.29641195372801749 -0.26115177051538974 0.5215866802396717 0.8336674104887164 -0.28602243309625308;0.94895360357908742 0.40183296103382732 -0.40867282674034355 0.5949392575416953 0.10271942288055956 -1.107733453895144 -0.72333488860982731 0.08338048219899985 0.41634011522990649;0.17409301625826959 0.70991533899923187 -0.23421405748565396 -1.3752331697361062 -0.68324942879795469 1.3532404450473023 -0.37776395168403121 -0.93615375058640571 0.39789827726609284;-0.94507947219404542 -0.61832334658233568 -0.21169880474245401 -1.1603294808840721 0.17999783101061906 -0.89279780952630405 -0.8467890169418375 -0.20554377901619758 0.78663622281106926];
  
  % Layer 2
  b2 = [-0.033189222740965127;0.58979331490708964;-0.3600398583972802;-0.30538872629608055];
  LW2_1 = [-0.23797052397203497 0.050918788698071892 0.13733014884816772 0.21641033283742531 -0.074124132388103892 -0.066167669342605873 -0.095104503341940816 0.070906733568988106 -0.21059945261700255 0.10685622579539347 0.035741415155549565 -0.39051286875138919 -0.36521685405558946 0.068261310743940082 0.50339316283499325 -0.41392770592134243 0.036271213337320141 -0.3877012542881601 -0.053903646260056455 0.134916703160394 -0.2994990340139011 0.17778730797415562 -0.096573131419246422 0.027146876122946931 -0.2116628408748375 0.17778741557407093 -0.17734157302567199 0.028303437553760503 0.027620622801900335 -0.071453744856532997 -0.24124119972550492 0.21553325580072846 -0.11598150534453909 0.17445963703164152 -0.12848490755772929 -0.067800111763730742 0.27060019864509366 0.00027923336155223979 0.10618659807368956 -0.087018542541633243 0.10392654277340142 -0.095258382069781405 -0.038698162668804346 0.054602363752121755 0.1902783891894298 -0.0062966296218204543 -0.085905364410194418 0.16727016539858916 -0.021320517520360033 -0.30744343974632965;-0.23327511816130911 -0.099659765902345557 0.1547786216953968 0.272048741831448 0.5347279727755937 -0.15824156581095697 0.084395729492292015 0.55055243250057972 -0.19819742697141024 -0.17356003447009888 -0.014267797999922123 0.0021319891409052952 0.27445412229790861 0.10752970126928399 0.39757446668974106 -0.36280146762217408 0.024507490788283397 -0.27906058745002787 -0.078613674311180493 -0.10929891655281142 0.14651391018123272 -0.31488499236486106 -0.089946707458171252 0.20313904497708379 -0.5176683701003908 0.074595604163971055 -0.19830171097172081 -0.047273600375631233 -0.053656659689241493 -0.087589674779192855 -0.034438123660785455 -0.38338736811555635 0.096809139142482611 0.68512555055974556 -0.13128095874322268 0.050586802689600877 -0.28036268340016218 0.32152432259724467 0.057443038819634286 0.075752799611161589 -0.46896187779870135 -0.050437522715694939 -0.24011454078978051 -0.70663007201388239 0.55888913869900403 -0.44216225013950439 0.60067430122088628 -0.46914357236156151 0.11788285811937907 -0.53157813190849479;-0.056700992493377157 0.48108102269072822 -0.18367155486827388 -0.122136418401264 0.50084326272525814 -0.48254055559609277 0.018200252314437108 0.43743693305647485 0.47148326110788324 0.69915285496035184 0.15723500654818418 -0.17885606087910855 0.22544148148677506 -0.0063314598979767218 -0.5218859212644793 0.39081116507152169 0.44882237303650763 0.289590870049799 -0.32132992749006706 -0.21395712242067813 -0.24044798507745035 -0.2657780887272882 0.32449513784664386 0.010797749139608176 -0.67054840666653137 0.21141541762531765 0.19847596136861864 0.11253750777140707 -0.30962868941843086 -0.29964054184028915 -0.49416279784150213 -0.27419148378113412 0.37812990383366363 -0.028045446813906368 0.099018987756334914 0.11891542158654553 -0.076010388921447555 -0.084863507642361447 -0.36571608022726176 0.13180650619556084 0.37589964909956325 0.29353279094212387 0.17317963552478732 -0.55711652245279342 0.17902758445561753 -0.33823844356116017 -0.41915580138651182 -0.47657957811164692 0.37243417911015125 0.21648782220705448;-0.58584435452515471 -0.51826858709029699 -0.16649316208328457 0.3397393264675988 -0.87358708910663407 -0.3074226600571478 0.13272836491315851 -0.11790184849755184 0.072494135973922583 0.61625815772358949 0.42592119271310025 -0.24502293365993738 -0.10177361617377147 0.12177369156032314 -0.080070621684561846 -0.69126275905274615 -0.093581221668684544 0.00031837498370614926 -0.26184810272192488 -0.06314582872491753 0.13511690235335319 0.0077651532165911308 -0.54868519711771113 -0.06447887654581598 -0.27267891015693241 0.1698128797174599 -0.11170352455642032 -0.39882908402559303 0.10335674674511182 -0.076906629896271866 -0.2092161779073527 -0.13662733547764999 -0.10631203751557348 -0.29332807893490159 0.2963362788998854 0.39526446914304464 0.29159940663149225 0.6737481809075776 -0.047512441510988337 -0.19713023026610499 0.76419094822831768 0.02112416670477222 0.16248155507520079 -0.25075474800445369 0.34900032827171784 -0.68721030547566386 -0.64845712503894481 -0.066749612282750254 0.15767228846640602 -0.31514829082671358];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = [2.23962518379857;2.81491188135518;1.00000201036013;1.00259532342615];
  y1_step1_xoffset = [-0.439400886380383;-0.479895273387133;-0.99999793580007;-0.994822789738156];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
